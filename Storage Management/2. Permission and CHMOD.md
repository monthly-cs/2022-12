# Permission and CHMOD

이 문서는 2022년 12월 4일 @unchaptered에 의해서 작성되었습니다.

```
1. Intro
2. Permission
  2.1. User과 File
    2.1.1. User 계정에 대하여
      2.1.1.a. Root User란?
      2.1.1.b. Basic User란?
    2.1.2. 루트 계정을 사용하기
      2.1.2.a. su를 사용하면?
      2.1.2.b. sudo를 사용하면?
    2.1.3. 깨알 이슈
  2.2. File 에 대하여
3. CHMOD
4. Refernces
```

## 1. Intro

이 문서에서는 **Permission에 대한 이해도와 그 제어방법**을 설명하고자 합니다.<br>
또한 각 상황을 체험할 수 있도록 [**SSCCE**](http://sscce.org/)에 맞는 간단한 예제를 포함하였습니다.

- 이 챕터에서는 File System에 대한 전반 지식이 있으면 도움이 되며, [@sumin-dev](https://github.com/sumin-dev)님이 작성해주신 [Monthly-CS/2022-12 - File system](https://github.com/monthly-cs/2022-12/blob/main/Storage%20Management/1.%20File%20system.md)를 먼저 읽어주시면 감사드리겠습니다.

## 2. Permission

### 2.1. 서론

개발을 하다 보면 여러 가지 Permission 이슈를 겪게 됩니다.<br>

이러한 경우 직관적인 GUI와 Solution을 제공해주는 Mac, Win과는 달리 Ubunut(Linux)는 이를 수정하기 불편합니다.<br>
또 때로는 어째서 이러한 일이 일어나는지 혼란스러운 순간도 있습니다.

> **예를 들어, 다음의 상황에서 pm2 is not defined가 뜰 수 있습니다.**<br>
> 1. sudo로 node 설치<br>
>   1.1. `curl -s https://deb.nodesource.com/setup_16.x | sudo bash`<br>
>   1.2. `sudo apt update`<br>
>   1.3. `sudo install nodejs`
> 2. sudo로 pm2 설치<br>
>   2.1. `sudo npm install pm2 -g`<br>
> 3. ubuntu로 pm2 start 입력<br>
>   3.1. `pm2 start`

> **또한, 다음의 상황에서는 pm2 status를 치면 아무것도 안나옵니다.**<br>
> 1. ubuntu로 pm2 start 입력<br>
>   1.1. `pm2 start sample.js`
> 2. sudo로 pm2 status 입력<br>
>   2.1. `sudo pm2 status`

어째서 이러한 일이 일어나는 걸까요?
이 부분에 대해서 제대로 이해하기 위해서는 다음의 세가지를 알아야 합니다.

1. 사용자
2. 파일
3. 권한

### 2.2. User와 File의 관계

위에서 언급한 **세가지**를 그려 놓은 다음의 그림을 보면서 설명을 읽어주세요.

![image](https://user-images.githubusercontent.com/86306802/205481710-dc5f3676-3d9e-4282-b818-5aea82a293a5.png)

유저는 크게 **루트 유저**와 **일반 유저**로 나뉘며, 일반 유저는 루트 유저의 일부 권한을 **상속**받아서 생성됩니다.<br>
파일은 **폴더, 파일** 뿐만 아니라 **디바이스**까지 포함하는 표현힙니다.

모든 권한 혹은 제한된 권한의 개념은 **유저의 파일에 대한 작업**에 관련된 내용입니다.


### 2.3. User 계정에 대하여

[Ubuntu Desktop 가이드](https://help.ubuntu.com/stable/ubuntu-help/user-accounts.html) 뿐만 아니라 많은 문서에서는 사용자를 위와 같이 **루트**와 **루트가 아닌 일반 사용자**로 구분하고 있습니다.

이러한 유저는 개별 파일(폴더, 기기, 파일 모두 포함)에 대한 권한을 가지게 됩니다.

#### 2.3.1. Root User란?

Ubuntu의 루트 사용자는 기본적으로 Windows Administartors User와 동일합니다.
즉, **최대 권한**을 가지고 시스템에 대해서 무엇이든 할 수 있습니다.

#### 2.3.2. Basic User란?

Ubuntu의 일반 사용자는 제한된 권한을 가지고 활동합니다.
즉, **S/W 설치 및 시스템 디렉토리 쓰기 작업** 등을 할 수 없습니다.

### 2.4. 루트 계정을 사용하기

루트 계정을 사용하기 위한 방법은 크게 다음과 같이 2가지가 있습니다.

1. su - 사용자를 루트 사용자 계정을 전환하고 루트 계정의 암호를 요구
2. sudo - 루트 권한으로 단일 명령을 실행 (암호 불필요)

#### 2.4.1. su를 사용하면?

su를 사용하면 **전체 루트 엑세스 권한**을 부여합니다.
`su -`로 로그인할 수 있고 `logout` 혹은 `Ctrl + D`로 su 모드에서 벗어날 수 있습니다.

하지만, su를 사용하게 되면 서버에 **여러 관리자**가 있는 경우 **하나의 암호**를 공유해야 합니다.
따라서 보안 및 유틸리티 측면에서 좋지 않습니다.

#### 2.4.2. sudo를 사용하면?

sudo를 사용하면 **루트 권한**만을 상속받아서 **단일 명령어**에 사용하게 됩니다.
특히, [ubuntu 운영체제에서는 su를 사용해서 루트 사용자가 될 수 없기 때문](https://www.beyondtrust.com/blog/entry/unix-linux-privileged-management-should-you-sudo)에 (기본적으로는) 보안상 안전해집니다.

/etc/sudoers

1980년대 sudo가 나온 이후, sudo가 훨씬 좋은 방식으로 권고 되고 네트워크 공급업체인 AWS 등도 이러한 sudo 방식을 기본적으로 사용하고 있습니다.
하지만 이 또한 다음과 같은 5가지 문제점을 포함하고 있습니다.

1. 효율적인 중앙 집중식 관리의 부족
2. **로컬 파일(/etc/sudoers)**의 존재로 인한 보안 위협성 증가
3. 보안 감사를 통과하기 어려울 수 있음
4. 로컬 파일 배포에 대한 좋은 방식이 필요
5. [권한 있는 사용자 사용 불가](https://www.beyondtrust.com/resources/glossary/privileged-access-management-pam) / MFA, Multi Factor Authentication 등

### 2.5. 깨알 이슈

가끔씩 루트 계정을 활성화 시킨 다음에, 일반 사용자에게 루트 권한을 주는 사람들이 세상에는 있다고 합니다.

이러한 이슈에 대해서 Ubuntu 오피셜 문서에서는 다음과 같이 언급하곤 합니다.

> At the time of the post, this was the users' first post on the Ubuntu forums. While some might call this a "learning experience", learning by breaking your system is frustrating and can result in data loss.

- [Ubuntu docs - RootSudo](https://help.ubuntu.com/community/RootSudo#Graphical_sudo)
- [Ubuntu thread - I broke my system by taking ownership of the root directory. Help needed.](https://ubuntuforums.org/showthread.php?t=1877557)

## 3. CHMOD

## 4. Refernces

Official Docs

- [Ubuntu - FilePermissions](https://help.ubuntu.com/community/FilePermissions)

Expert's Guide Docs

- [How-To Geek - What’s the Difference Between Sudo and Su in Linux?](https://www.howtogeek.com/111479/htg-explains-whats-the-difference-between-sudo-su/)
- [Nexcess - Change Mode (chmod) Meaning: What is chmod?](https://www.nexcess.net/help/what-is-chmod/)
- [How-To Geek - How to Use the chmod Command on Linux](https://www.howtogeek.com/437958/how-to-use-the-chmod-command-on-linux/)

- [BeyondTrust - Privileged Access Management (PAM)](https://www.beyondtrust.com/resources/glossary/privileged-access-management-pam)
