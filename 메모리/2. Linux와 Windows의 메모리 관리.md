
# Windows의 메모리 관리


# Windows와 Linux 비교

| Windows | Linux |
|:-|:-|
|물리 메모리는 필요할 때 동적으로 커널 주소 공간으로 사상된다.| 896MB까지의 물미 메모리는 정적으로 커널 주소 공간(32비트)에 사상되고, 나머지는 고정된 128MB 커널 주소 공간(불연속 사용도 가능함)에 동적으로 사상된다. |
| 커널과 응용은 TLB 효율을 위해 x86 large page를 사용할 수 있다. | - |
| 커널 및 드라이버의 코드나 데이터 중 많은 부분이 페이징되며, 부팅 후 초기화 코드는 제거된다. 페이지 테이블도 완전히 페이징된다. | 커널은 페이징되지 않는다. 모듈들은 페이징되지는 않지만 제거될 수 있다. |
| 물리 객체(파일, 장치, 물리 메모리)에 대한 주소 사상은 가상 주소 공간의 사용자 모드 할당과 구별된다. | 사용자 모드 주소는 물리 객체에 직접 사상된다. |
| AWE(Address Windwing Extensions: 오버레이 기법과 유사)를 이용할 경우, 큰 응용 프로그램은 직접 무릴 메모리를 할당받아 주소 공간에 사상시켜 활용할 수 있다. | - |
| Copy-on-write 지원 | Copy-on-write 지원 |
| 정상적인 사용자/커널 분할은 2GB/2GB이며, 3GB/1GB로 설정ㆍ부팅될 수 있다. | 정상적인 사용자/커널 분할은 3GB/1GB이다. Linux는 커널과 사용자의 주소 공간을 분리ㆍ수행할 수 있어서, 사용자에게 4GB를 모두 할당할 수도있다. |
| 캐시 관리자는 파일을 커널 주소 공간에 사상시켜 관리한다. 이를 위해 가상 메모리 관리자는 페이지들에 대한 대기 리스트(standby list)와 변경 리스트(modified list)를 이용하여 실질적인 페이징과 캐싱을 담당한다. | 페이지 캐시는 페이지에 대한 캐싱을구현하며, 페이징 시스템을 위한 "lookaside 캐시"로 사용된다. |
| 쓰레드는 캐시 관리자를 우회하여 직접 입출력을 수행할 수 있다. | 프로세스는 페이지 캐시를 우회할 수 있다. |
| PFN(페이지 프레임 번호) 데이터베이스는 중추적인 자료구조이다. PFN 내의 페이지들은 프로세스의 페이지 테이블에 등록되거나, standby list, modified list, free list, badd list 중 하나에 연결된다. | 프로세스의 주소 공간에서 제거된 페이지들은 페이지 캐시에 유지ㆍ관리된다. |
| 섹션 객체는 파일과 같이 사상 가능한 메모리 객체로, 요구생성(create-on-demand)되고 페이징되는 프로토타입 페이지 테이블을 포함하고 있다. 이 페이지 테이블은, 결함 발생한 페이지가 이미 트랜잭션으로 처리되고 있을 때를 포함하여, 각 페이지가 어디에 위치하는지 파악하는 데 사용될 수 있다. | 스왑 캐시는 폴트 발생 페이지에 대한 복수 개의 인스턴스를 관리하는 데 사용된다. |
| 커널 모드(시스템 프로세스)와 프로세스 모두에 대해 작업 집합(working set) 기반의 페이지 교체 알고리즘이 적용된다. | 페이지 교체에 전역 클록 알고리즘이 사용된다. |
| 보안을 목적으로, 페이지 파일들을 암호화하고 회수된 가용 페이지의 내용은 지운다. | - |
| 필요할 때 페이징 파일 내에 공간을 할당함으로써, 기록 작업은 반납된 페이지들의 그룹에 대해 지역화된다. 공유 페이지들은 섹션 객체와 연계된 프로토타입 페이지 테이블을 통해 간접 사용되어, 페이지 파일 공간은 즉시 반납될 수 있다. | 필요할 때 스왑 디스크 내에 공간을 할당함으로써, 기록 작업은 반납된 페이지들의 그룹에 대해 지역화된다. 공유 페이지들은 스왑 슬롯을 유지하는데, 스왑 슬롯은 모든 프로세스가 해당 페이지에 대한 폴트를 발생시켜 반입을 요구하게 될 때까지 유지된다. |

# References

[Windows Memory Management](https://www.geeksforgeeks.org/windows-memory-managment/)
